# Neovim
if type nvim > /dev/null 2>&1; then
    alias vi='nvim'
    alias vim='nvim'
fi

# tmux
alias mux='tmuxinator'
function tm() {
    name="${1:-default}"
    tmux attach -t "$name" || tmux new -s "$name"
}

# GPG
alias gpg='gpg2'

# Docker
alias docker-stop='docker stop $(docker ps -aq)'
alias docker-clean='docker rm -f $(docker ps -aq)'
alias docker-purge='docker rmi -f $(docker images -aq)'

# Stack
alias stack-update='stack --resolver nightly setup --reinstall --install-ghc'
alias nstack='stack --resolver nightly'

# NPM
alias npm-tasks="jq '.scripts' < package.json"

# Common tool aliases
alias c='clear'
alias less='less -FSRXc'
alias qfind='find . -name'
alias get='curl --continue-at - --location --progress-bar --remote-name --remote-time'

# directory ops
alias cpr='cp -r'
alias rmr='rm -r'

# ls
alias l='ls -lAh'
alias la='ls -lAh'
alias lm="l | ${PAGER}"
alias ll='ls -lh'
alias lr='ll -R'
alias lsh='ls -lAhd .?*'

# grep
export GREP_COLOR='37;45'
export GREP_COLORS="mt=${GREP_COLOR}"
alias grep='grep --color=auto'

# mkdir
alias mkdir='mkdir -p'
function mkcd() {
    [[ -n ${1} ]] && mkdir -p ${1} && cd ${1}
}

# resource usage
alias df='df -khT'
alias du='du -khsc'
function sizeof() {
    [ -n "$1" ] && du "$1" | tail -1 | cut -f1
}

if [ "$(uname)" = "Linux" ]; then

    # GPG
    export GPG_TTY=$(tty)
    gpg-connect-agent updatestartuptty /bye >/dev/null

    # Python
    alias pip-upgrade="pip3 list --outdated --user | cut -d ' ' -f 1 | xargs -n 1 pip3 install --upgrade --user"

    # VSCode
    alias code="code --user-data-dir "$XDG_CONFIG_HOME/vscode" --extensions-dir "$XDG_CONFIG_HOME/vscode/extensions""
    alias vscode='code'

    # Clipboard
    alias setclip='xclip -selection clipboard -i'
    alias getclip='xclip -selection clipboard -o'

    # Aliases
    alias f='(pcmanfm . > /dev/null 2>&1 &)'

    # Modifying permissions
    alias chmod='chmod --preserve-root -v'
    alias chown='chown --preserve-root -v'

    # ls colours
    eval "$(dircolors --sh)"
    alias ls='ls --group-directories-first --color=auto'

    # Package manager
    alias appupdate='sudo apt update && sudo apt upgrade'
    alias appinstall='sudo apt install'
    alias appremove='sudo apt remove'
    alias apppurge='sudo apt purge --autoremove'
    alias appsearch='sudo apt search'
    alias appclean='sudo apt autoremove'

    # Chrome apps
    alias fastmail='chrome-app FastMail https://www.fastmail.com'
    alias inbox='chrome-app Inbox https://inbox.google.com'
    alias messenger='chrome-app Messenger https://messenger.com'
    alias whatsapp='chrome-app WhatsApp https://web.whatsapp.com'

    function appcleanall() {
        sudo dpkg -P $(dpkg -l | awk '/^rc/ { print($2) }')
    }

    function applist() {
        dpkg-query -f '${binary:Package}\n' -W | less
    }

    # Checkinstall
    alias makeinstall='sudo checkinstall --default --install=yes --nodoc --deldoc=yes --deldesc=yes --delspec=yes --backup=no'

    # Rust
    export RUST_SRC_PATH="$RUSTUP_HOME/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src"

    # Android SDK/NDK
    export JAVA_HOME="/opt/java/jdk"
    export PATH="$PATH:$JAVA_HOME/bin"

elif [ "$(uname)" = "Darwin" ]; then

    # Ruby
    if type rbenv > /dev/null 2>&1; then
        eval "$(rbenv init -)"
        alias rbenv-override="rbenv shell $(rbenv global)"
        alias be='bundle exec'
        alias ber='bundle exec rake'
    fi

    # Python
    alias pip-upgrade="pip3 list --outdated | cut -d ' ' -f 1 | xargs -n 1 pip3 install --upgrade"

    # VSCode
    alias vscode='code'

    # Vim (work around tmux issue on macOS sierra)
    alias nvim='reattach-to-user-namespace -l nvim'

    # GPG Agent
    if [ -f ~/.gnupg/gpg-agent-info ]; then
        source ~/.gnupg/gpg-agent-info
    fi

    # GPG
    export GPG_TTY=$(tty)
    if [ -S "${GPG_AGENT_INFO%%:*}" ]; then
        export GPG_AGENT_INFO
    fi

    export BROWSER='open'

    # OpenSSL
    export OPENSSL_INCLUDE_DIR=/usr/local/opt/openssl/include
    export DEP_OPENSSL_INCLUDE=/usr/local/opt/openssl/include

    # Rust
    export RUST_SRC_PATH="$RUSTUP_HOME/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/src"

    # Android SDK/NDK
    export ANT_ROOT=/usr/local/Cellar/ant/1.9.7/bin
    export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home
    export PATH="$PATH:$JAVA_HOME/bin"

    # Cocos2d-x
    alias cocos="$HOME/Developer/projects/pulse/libs/cocos2d/tools/cocos2d-console/bin/cocos"
    alias fbx-conv="$HOME/Developer/projects/pulse/libs/cocos2d/tools/fbx-conv/mac/fbx-conv"

    # Aliases
    alias f='open -a Finder ./'

    # Package manager
    alias appupdate='brew update && brew upgrade'
    alias appinstall='brew install'
    alias appremove='brew uninstall'
    alias appsearch='brew search'
    alias appclean='brew cleanup && brew cask cleanup && brew prune'
    alias appdoctor='brew doctor && brew cask doctor'

    # ls colours
    export LSCOLORS='exfxcxdxbxGxDxabagacad'
    export LS_COLORS='di=34:ln=35:so=32:pi=33:ex=31:bd=36;01:cd=33;01:su=31;40;07:sg=36;40;07:tw=32;40;07:ow=33;40;07:'
    alias ls='ls -G'

    # Moves a file to the MacOS trash
    function trash() {
        command mv "$@" ~/.Trash
    }

    # Opens any file in Preview
    function ql() {
        qlmanage -p "$*" > /dev/null 2>&1
    }
fi

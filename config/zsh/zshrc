#
# Executes commands at the start of an interactive session.
#

# Source default profile
if [ -f "$HOME/.profile" ]; then
    source "$HOME/.profile"
fi

# Load zim plugins
if [ -s "$ZDOTDIR/.zim/init.zsh" ]; then
    source "$ZDOTDIR/.zim/init.zsh"
fi

# Load OS specific configuration
if [ -s "$ZDOTDIR/.zshrc.env" ]; then
    source "$ZDOTDIR/.zshrc.env"
fi

# Docker
if type docker > /dev/null 2>&1; then
    alias docker-stop="$HOME/scripts/docker/stop-all-containers.sh"
    alias docker-clean="$HOME/scripts/docker/remove-all-containers.sh"
    alias docker-purge="$HOME/scripts/docker/remove-all-images.sh"
fi

# Clipboard
if type xclip > /dev/null 2>&1; then
    alias setclip='xclip -selection clipboard -i'
    alias getclip='xclip -selection clipboard -o'
fi

# Fuzzy command line search
if [ -d "$XDG_CONFIG_HOME/fzf" ]; then
    export FZF_COMPLETION_TRIGGER='~~'
    export PATH="$PATH:$XDG_CONFIG_HOME/fzf/bin"
    export MANPATH="$MANPATH:$XDG_CONFIG_HOME/fzf/man"
    source "$XDG_CONFIG_HOME/fzf/shell/completion.zsh" 2> /dev/null
fi

# Enhancd
if [ -s "$HOME/scripts/enhancd.sh" ]; then
    export ENHANCD_DIR="$XDG_DATA_HOME/enhancd"
    source "$HOME/scripts/enhancd.sh"
fi

# Bundle
if type bundle > /dev/null 2>&1; then
    alias be='bundle exec'
    alias ber='bundle exec rake'
fi

# Rust
if [ "$CARGO_HOME" ]; then
    export PATH="$PATH:$CARGO_HOME/bin"
fi

# Common tool aliases
alias j='fasd_cd -d'
alias jj='fasd_cd -d -i'
alias la='ls -lAh'
alias mkdir='mkdir -p'
alias less='less -FSRXc'
alias qfind='find . -name'

# Normal mode keybindings
bindkey -v
bindkey '[C' forward-word       # alt+left
bindkey '[D' backward-word      # alt+right
bindkey '^0[C' forward-word     # ctrl+left
bindkey '^0[D' backward-word    # ctrl+right
bindkey '^[[3^' kill-word       # ctrl+delete
bindkey '^H' backward-kill-word # ctrl+backspace
bindkey '^A' beginning-of-line
bindkey '^E' end-of-line
bindkey '^K' kill-line
bindkey '^U' backward-kill-line
bindkey '^T' transpose-chars
bindkey '^P' up-history
bindkey '^N' down-history
bindkey '^R' history-incremental-search-backward
bindkey '^F' vi-cmd-mode

# Vim mode keybindings
bindkey -M vicmd '/' history-incremental-search-backward
bindkey -M vicmd '?' history-incremental-search-forward
bindkey -M vicmd 'v' edit-command-line
bindkey -M vicmd 'u' undo
bindkey -M vicmd '^R' redo

export KEYTIMEOUT=10

# De-duplicate array paths
typeset -gU cdpath fpath mailpath path

if (( $#commands[(i)lesspipe(|.sh)] )); then
    export LESSOPEN="| /usr/bin/env $commands[(i)lesspipe(|.sh)] %s 2>&-"
fi

# Temporary Files
if [ ! -d "$TMPDIR" ]; then
    export TMPDIR="/tmp/$LOGNAME"
    mkdir -p -m 700 "$TMPDIR"
fi

TMPPREFIX="${TMPDIR%/}/zsh"

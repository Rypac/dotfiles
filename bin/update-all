#!/usr/bin/env bash

: "${DOTFILES_HOME:="$HOME/.dotfiles"}"

# dotfiles
if [ -d "$DOTFILES_HOME" ]; then
    (
        cd "$DOTFILES_HOME"
        git pull
        ./install
    )
else
    echo "Invalid dotfiles directory" && exit 1
fi

# brew packages
if command -v brew >/dev/null 2>&1; then
    brew update
    brew upgrade
    brew bundle --file="$DOTFILES_HOME/mac/Brewfile"
fi

# /etc/hosts content blocking
diff -bq /etc/hosts <(curl -s 'https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts') >/dev/null 2>&1
if [ "$?" -ne 0 ]; then
    echo 'Hosts update available: https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts'
fi

# Generate vim package help docs
vim -c 'helptags ALL' +qall

# rustup
if command -v rustup >/dev/null 2>&1; then
    rustup update
fi

# GHCup
if command -v ghcup >/dev/null 2>&1; then
    ghcup upgrade
fi
